var d={},S=(v,L,I)=>(d.__chunk_3993=(O,p,A)=>{"use strict";A.d(p,{_:()=>f});class _{constructor(e){this.config=e}async query(e,s=[]){try{let{accountId:r,apiToken:c,databaseId:o}=this.config;if(!r||!c||!o)return{success:!1,error:"Missing Cloudflare D1 credentials"};let n=e;s.length>0&&s.forEach((t,y)=>{let u,h=`$${y+1}`;u=t==null?"NULL":typeof t=="string"?`'${t.replace(/'/g,"''")}'`:typeof t=="number"?t.toString():typeof t=="boolean"?t?"1":"0":`'${String(t).replace(/'/g,"''")}'`,n=n.replace(RegExp(h,"g"),u)});let E=`https://api.cloudflare.com/client/v4/accounts/${r}/d1/database/${o}/query`,l=await fetch(E,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({sql:n})});if(!l.ok){let t=await l.json();return{success:!1,error:`D1 API Error: ${JSON.stringify(t)}`}}let a=await l.json();return{success:!0,data:a.result?.[0]?.results||[],meta:{changes:a.result?.[0]?.changes||0,last_row_id:a.result?.[0]?.last_row_id||0,duration:a.result?.[0]?.duration||0}}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error occurred"}}}}class g{constructor(e){this.config=e}async query(e,s=[]){try{return{success:!1,error:"PostgreSQL provider not implemented yet"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"PostgreSQL query failed"}}}async close(){}}class D{constructor(e){this.config=e}async query(e,s=[]){try{return{success:!1,error:"MySQL provider not implemented yet"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"MySQL query failed"}}}async close(){}}class f{static createProvider(e,s){switch(e){case"cloudflare-d1":return new _(s);case"postgresql":return new g(s);case"mysql":return new D(s);default:throw Error(`Unsupported database type: ${e}`)}}static getDefaultProvider(e){let s=typeof process<"u"&&process.env.APP_ENV==="PRODUCTION"||!0,r=process.env.DATABASE_TYPE||"cloudflare-d1";if(s){if(!e?.DB){console.warn('D1 binding "env.DB" is missing, falling back to API connection');let n={accountId:process.env.CLOUDFLARE_ACCOUNT_ID,apiToken:process.env.CLOUDFLARE_API_TOKEN_D1,databaseId:process.env.CLOUDFLARE_D1_DATABASE_ID,region:process.env.DATABASE_REGION};return this.createProvider(r,n)}let o={binding:e.DB,accountId:process.env.CLOUDFLARE_ACCOUNT_ID,databaseId:process.env.CLOUDFLARE_D1_DATABASE_ID,region:process.env.DATABASE_REGION};return this.createProvider(r,o)}let c={accountId:process.env.CLOUDFLARE_ACCOUNT_ID,apiToken:process.env.CLOUDFLARE_API_TOKEN_D1,databaseId:process.env.CLOUDFLARE_D1_DATABASE_ID,connectionString:process.env.DATABASE_URL,region:process.env.DATABASE_REGION};return this.createProvider(r,c)}}},d);export{S as __getNamedExports};
