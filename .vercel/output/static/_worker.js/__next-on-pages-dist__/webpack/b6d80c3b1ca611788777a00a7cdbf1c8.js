var v={},x=(j,K,N)=>(v.__chunk_5697=(T,b,c)=>{"use strict";c.d(b,{FA:()=>m,_H:()=>k,b9:()=>H});var l=c(794),y=c(5356).Buffer;async function m(a,o){return await(0,l._S)(a,o)}async function _(a,o){try{return await(0,l.MX)(a,o)}catch{throw Error("Invalid token")}}async function C(a){let o=new TextEncoder().encode(a);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",o))).map(s=>s.toString(16).padStart(2,"0")).join("")}async function H(a,o){return await C(a)===o}async function k(a){let o=a.headers.get("authorization");if(!o||!o.startsWith("Bearer "))throw Error("No token provided");let s=o.replace("Bearer ","");try{let n=JSON.parse(y.from(s,"base64").toString());if(n.exp&&n.exp<Date.now())throw Error("Token expired");if(!n.adminId||!n.username)throw Error("Invalid token payload");return{adminId:n.adminId,username:n.username,role:n.role||"admin"}}catch{try{let h=await _(s,process.env.JWT_SECRET||"fallback-secret");if(!h.adminId||!h.username||!h.role)throw Error("Invalid token payload");return h}catch{throw Error("Invalid token")}}}},v.__chunk_794=(T,b,c)=>{"use strict";function l(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}c.d(b,{MX:()=>h,_S:()=>n});function y(e){return btoa(String.fromCharCode(...new TextEncoder().encode(e))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function m(e){return l(atob(e.replace(/-+(BEGIN|END).*/g,"").replace(/\s/g,"")))}async function _(e,t,r){return await crypto.subtle.importKey("raw",l(e),t,!0,r)}async function C(e,t,r){return await crypto.subtle.importKey("jwk",e,t,!0,r)}async function H(e,t,r){return await crypto.subtle.importKey("spki",m(e),t,!0,r)}async function k(e,t,r){return await crypto.subtle.importKey("pkcs8",m(e),t,!0,r)}async function a(e,t,r){if(typeof e=="object")return C(e,t,r);if(typeof e!="string")throw Error("Unsupported key type!");return e.includes("PUBLIC")?H(e,t,r):e.includes("PRIVATE")?k(e,t,r):_(e,t,r)}function o(e){let t=Array.from(atob(e),r=>r.charCodeAt(0));return JSON.parse(new TextDecoder("utf-8").decode(new Uint8Array(t)))}if(typeof crypto>"u"||!crypto.subtle)throw Error("SubtleCrypto not supported!");var s={none:{name:"none"},ES256:{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}},ES384:{name:"ECDSA",namedCurve:"P-384",hash:{name:"SHA-384"}},ES512:{name:"ECDSA",namedCurve:"P-521",hash:{name:"SHA-512"}},HS256:{name:"HMAC",hash:{name:"SHA-256"}},HS384:{name:"HMAC",hash:{name:"SHA-384"}},HS512:{name:"HMAC",hash:{name:"SHA-512"}},RS256:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},RS384:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}},RS512:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}}};async function n(e,t,r="HS256"){if(typeof r=="string"&&(r={algorithm:r}),r={algorithm:"HS256",header:{typ:"JWT",...r.header??{}},...r},!e||typeof e!="object")throw Error("payload must be an object");if(r.algorithm!=="none"&&(!t||typeof t!="string"&&typeof t!="object"))throw Error("secret must be a string, a JWK object or a CryptoKey object");if(typeof r.algorithm!="string")throw Error("options.algorithm must be a string");let p=s[r.algorithm];if(!p)throw Error("algorithm not found");e.iat||(e.iat=Math.floor(Date.now()/1e3));let f=`${y(JSON.stringify({...r.header,alg:r.algorithm}))}.${y(JSON.stringify(e))}`;if(r.algorithm==="none")return f;let g=t instanceof CryptoKey?t:await a(t,p,["sign"]),d=await crypto.subtle.sign(p,g,l(f));return`${f}.${btoa(function(S){let w="";for(let u=0;u<S.byteLength;u++)w+=String.fromCharCode(S[u]);return w}(new Uint8Array(d))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}`}async function h(e,t,r="HS256"){var p,f,g;if(typeof r=="string"&&(r={algorithm:r}),r={algorithm:"HS256",clockTolerance:0,throwError:!1,...r},typeof e!="string")throw Error("token must be a string");if(r.algorithm!=="none"&&typeof t!="string"&&typeof t!="object")throw Error("secret must be a string, a JWK object or a CryptoKey object");if(typeof r.algorithm!="string")throw Error("options.algorithm must be a string");let d=e.split(".",3);if(d.length<2)throw Error("token must consist of 2 or more parts");let[S,w,u]=d,E=s[r.algorithm];if(!E)throw Error("algorithm not found");let i={header:o((p=e).split(".")[0].replace(/-/g,"+").replace(/_/g,"/")),payload:o(p.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))};try{if(i.header?.alg!==r.algorithm)throw Error("INVALID_SIGNATURE");if(i.payload){let A=Math.floor(Date.now()/1e3);if(i.payload.nbf&&i.payload.nbf>A&&i.payload.nbf-A>(r.clockTolerance??0))throw Error("NOT_YET_VALID");if(i.payload.exp&&i.payload.exp<=A&&A-i.payload.exp>(r.clockTolerance??0))throw Error("EXPIRED")}if(E.name==="none")return i;let I=t instanceof CryptoKey?t:await a(t,E,["verify"]);if(!await crypto.subtle.verify(E,I,(g=u,l(atob(g.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")))),(f=`${S}.${w}`,l(f))))throw Error("INVALID_SIGNATURE");return i}catch(I){if(r.throwError)throw I;return}}},v);export{x as __getNamedExports};
